<html>
  <head> </head>
  <body>
    <div id="content"></div>
    <script>
      class SimpleTemplateEngine {
        constructor(template_url) {
          this.template_url = template_url;
        }

        loadTemplate() {
          return fetch(this.template_url)
            .then((response) => response.text())
            .then((text) => (this.template = text));
        }

        renderTemplate(tag_id, data) {
          const tag = document.getElementById(tag_id);
          let output = this.template;
          // output = output.replace("{{title}}", data.title);
          // output = output.replace("{{content}}", data.content);

          /* Using Object.keys */

          // Object.keys(data).forEach((key) => {
          //   let specialTag = "{{" + key + "}}";
          //   output = output.replace(specialTag, data[key]);
          // });

          /* Using Regex */

          /* deals with any each loops */
          output = output.replace(
            /{{#each (\w+)}}([\s\S]*?){{\/each}}/g,
            (match, arrayName, templeFragment) => {
              const listOfThings = data[arrayName];

              if (!Array.isArray(listOfThings)) {
                return "";
              }
              return listOfThings
                .map((item) =>
                  this.replaceVariablesInFragment(templeFragment, item)
                )
                .join("");
            }
          );

          /* Handle if-else conditions */
          output = output.replace(
            /{{#if (\w+)}}([\s\S]*?){{else}}([\s\S]*?){{\/if}}/g,
            (match, condition, ifContent, elseContent) => {
              return data[condition] ? ifContent : elseContent;
            }
          );

          /* Handle if conditions without else */

          output = output.replace(
            /{{#if (\w+)}}([\s\S]*?){{\/if}}/g,
            (match, condition, ifContent) => {
              return data[condition] ? ifContent : "";
            }
          );

          /* deal with any simple variables */
          output = output.replace(/{{(\w+)}}/g, (match, dataField) => {
            return data[dataField];
          });

          tag.innerHTML = output;
        }
        replaceVariablesInFragment(templeFragment, data) {
          return templeFragment.replace(/{{(\w+)}}/g, (match, dataKey) => {
            return data[dataKey];
          });
        }
      }

      const tEngine = new SimpleTemplateEngine("template.html");

      const data = {
        title: "Page title",
        content: "Page content",
        subTitle: "Sub Title",
        subContent: "Sub Content",
        loggedIn: false,
        username: "omw",
        items: [
          {
            title: "item 1",
            description: "Desc 1",
          },
          {
            title: "item 2",
            description: "Desc 2",
          },
          {
            title: "item 3",
            description: "Desc 3",
          },
        ],
      };

      tEngine.loadTemplate().then(() => {
        tEngine.renderTemplate("content", data);
      });
    </script>
  </body>
</html>
